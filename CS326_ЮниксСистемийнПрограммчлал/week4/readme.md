# Доод түвшний оролт, гаралт, дараалсан болон санамсаргүй хандалт

## Файлын оролт гаралтын үндсэн 4 функц

* open()

* close()

* read()

* write()

## Буферлэгдээгүй оролт, гаралт

* Дискний тухайн сектор луу уншигчийн толгой очоод тухайн хэсгээ унших явдал юм

### Файл нээх

`fd = open(name, flags, mode)`

* name 

	* "./file.txt"
	* "home/test/text.txt"

* flags 

	* O_RDONLY, O_WRONLY. O_RDWR
	* O_APPEND, O_CREAT, O_TRUNC

* mode 

	* Файлын анх удаа үүсгэж байгаа үед л ач холбогдолтой
	* Бусад үед ач холбогдолгүй
	* Үүсэн файл нь ямар файлын горимтой байхыг зааж өгнө.
	* Гэхдээ файлын горим нь тухаын файлыг үүсгэж байгаа програмын процессын горимоор хязгаарлагдана.

* fd
	* Боломжит хамгийн бага утгыг буцаана.

### Стандарт урсгалууд

* Кейбоард

	- fd=0
	- stdin

* Стандарт гаралт – Дефаултаараа дэлгэц (tty төхөөрөмж)
	- fd=1
	- stdout

* Стандарт алдааны гаралт – Дефаултаараа дэлгэц

	- Fd=2
	- stderr

### Симболик тогтмолуудыг нийлүүлэн хэрэглэх нь

* Зарим системийн дуудалтууд нь флаг авна. Флаг нь симболик тогтмолууд байдаг.

	- Зарим нь интежер тогтмолууд байна (1, 2, 3, 4, ...)
	- Зарим нь дан-бит утгууд байна. Эдгээр утгуудыг битийн түвшинд OR хийж нэгтгэн ашиглаж болдог.
		
		- #define O_CREAT 0100
		- #define O_TRUNC 01000
		- #define O_APPEND 02000

* fd = open("linuxProg", O_RDWR | O_TRUNC | O_APPEND)

### Буферлэгдээгүй гаралт 

* Санах ойд байгаа өгөгдөл → Файл руу)
* write(fd, buffer, count)

### Буферлэгдээгүй оролт

* Файл → Санах ой
* read(fd, buffer, count)
* read() функц нь уншсан байтын тоог буцаана. Харин файлын төгсгөлд ирсэн бол 0 гэсэн утга буцаадаг.

## Файлаа хаах

* Файлаасаа уншиж, бичиж дууссан бол заавал хаах ёстой
* close(fd)
* Хаасны дараа тухай файлын дескрипторыг өөр програм буюу процесс ашиглах боломж нээж өгнө.
* Тухайн процесс нь нийт хичнээн файлын дескрипторыг нэгэн зэрэг эзэмшиж болох тоон хязгаар байдаг.

### Дараалсан файлын хандалт

* Эхлэлээс төгсгөл хүртэл дараалж хандана.

- Линукс систем нь файлын хаана уншилт явагдаж байгааг заасан файлын байршилын заагчтай байдаг. Дараагийн read(), write() дуудагдах үед хаана бичих, уншихаа шийдэхэд хэрэг болно.
- read(fd, buffer, 1200) функц дуудагдлаа гэж үзвэл. Уг функц дуудагдангуут файлын заагч нь 1200 болно.
- Тэгээд read(fd, buffer, 600) гэвэл уг дуудалтын дараа файлын заагч нь 1800 -г заана.

### Санамсаргүй хандалт

* Файлын заагчийн утга өөрчлөх замаар хүссэн газраа хандах

* lseek(fd, offset, whence)

* Offset
	
	- Байтын офсет, нэмэх эсвэл хасах байж болно
* Whence
	
	- Офсет нь юунд харьцангуй вэ гэдгийг заана

		* SEEK_SET – Файлын эхнээс
		* SEEK_CUR – Одоогийн байршилаас
		* SEEK_END – Файлын төгсгөлөөс


* Файлын заагч одоо 500 дээр байлаа гэж үзье
* lseek(fd, 100, SEEK_CUR); гэвэл файлын заагч 600 руу шилжиж очно.
* lseek(fd, 100, SEEK_SET); гэвэл шууд 100 руу очно.
* seek(fd, -100, SEEK_END); гэвэл файлын төгсгөлөөс эхлэн тоолоод 100 дах байт дээр очно.

* lseek(fd, 100, SEEK_END) гэвэл юу болох вэ?

	- Тухайн файл нь 100 байтаар урт болж нэмэгдэнэ.
	- Хэрэв read() хийвэл файлын төгсгөлөө шууд уншина.
	- Харин write() хийвэл тухайн файлын төгсгөлөөс 100 ширхэг хоосон 0 утга бичигдэнэ.


